<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Interactieve Video</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f0f0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; width: 100%; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        video { width: 100%; display: block; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; padding: 20px; }
        .overlay.active { display: flex; }
        .question-box { background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 100%; }
        .question-title { font-size: 20px; margin-bottom: 20px; color: #333; }
        .answer { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 8px; cursor: pointer; border: 2px solid transparent; }
        .answer:hover { background: #e0e0e0; }
        .answer.selected { border-color: #4CAF50; }
        .answer.correct { background: #d4edda; border-color: #28a745; }
        .answer.incorrect { background: #f8d7da; border-color: #dc3545; }
        .feedback { padding: 15px; margin-bottom: 15px; border-radius: 8px; display: none; }
        .feedback.show { display: block; }
        .feedback.correct { background: #d4edda; color: #155724; }
        .feedback.incorrect { background: #f8d7da; color: #721c24; }
        button { background: #4CAF50; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: #45a049; }
        .info-bar { padding: 15px 20px; background: #f8f9fa; display: flex; justify-content: space-between; }
        .completion { text-align: center; padding: 50px 30px; display: none; }
        .completion.active { display: block; }
        .completion h2 { color: #333; margin-bottom: 20px; }
        .completion .score { font-size: 48px; color: #4CAF50; margin: 20px 0; }
        .completion .score.failed { color: #dc3545; }
        .btn-retry { background: #6c757d; }
        .btn-retry:hover { background: #5a6268; }
        .btn-continue { background: #28a745; }
        .btn-continue:hover { background: #218838; }
    </style>
</head>
<body>
    <div class="container">
        <div style="position: relative;">
            <video id="video" controls></video>
            <div id="overlay" class="overlay">
                <div class="question-box">
                    <div id="feedback" class="feedback"></div>
                    <div id="questionText" class="question-title"></div>
                    <div id="answersContainer"></div>
                    <div>
                        <button id="submitBtn">Controleer</button>
                        <button id="continueBtn" style="display: none;">Ga Verder</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="infoBar" class="info-bar">
            <div>Score: <strong id="score">0 / 0</strong></div>
            <div>Vraag <span id="current">0</span> van <span id="total">0</span></div>
        </div>
        <div id="completion" class="completion">
            <h2>Video Voltooid!</h2>
            <div id="finalScore" class="score"></div>
            <p id="finalMessage" style="font-size: 18px; margin: 20px 0;"></p>
            <button onclick="location.reload()" class="btn-retry">üîÑ Opnieuw Bekijken</button>
            <button id="continueToRise" class="btn-continue" style="display: none;">‚úÖ Ga Verder met E-learning</button>
        </div>
    </div>
    <script>
        let data, currentQ = 0, correct = 0, answered = new Set(), waiting = false;
        
        fetch('data.json').then(r => r.json()).then(d => {
            data = d;
            video.src = d.videoFileName;
            document.getElementById('total').textContent = d.questions.length;
            updateScore();
        });
        
        video.addEventListener('timeupdate', function() {
            if (waiting) return;
            const t = video.currentTime;
            data.questions.forEach(function(q, i) {
                if (!answered.has(i) && t >= q.time && t < q.time + 0.5) showQ(i);
            });
        });
        
        video.addEventListener('ended', function() {
            if (answered.size === data.questions.length) showCompletion();
        });
        
        function showQ(i) {
            video.pause();
            waiting = true;
            currentQ = i;
            const q = data.questions[i];
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('current').textContent = answered.size + 1;
            
            answersContainer.innerHTML = q.answers.map(function(a, j) {
                return '<div class="answer" data-index="' + j + '">' + a.text + '</div>';
            }).join('');
            
            document.querySelectorAll('.answer').forEach(function(el) {
                el.onclick = function() {
                    document.querySelectorAll('.answer').forEach(function(e) { e.classList.remove('selected'); });
                    el.classList.add('selected');
                };
            });
            
            submitBtn.style.display = 'block';
            continueBtn.style.display = 'none';
            feedback.className = 'feedback';
            overlay.classList.add('active');
        }
        
        submitBtn.onclick = function() {
            const selected = document.querySelector('.answer.selected');
            if (!selected) return alert('Selecteer een antwoord');
            
            const idx = parseInt(selected.dataset.index);
            const q = data.questions[currentQ];
            const isCorrect = q.answers[idx].correct;
            
            if (isCorrect) {
                feedback.textContent = q.correctFeedback || '‚úì Correct!';
                feedback.className = 'feedback correct show';
                correct++;
            } else {
                const correctA = q.answers.find(function(a) { return a.correct; });
                const incorrectText = q.incorrectFeedback || '‚úó Fout. Juiste antwoord:';
                feedback.textContent = incorrectText + ' ' + correctA.text;
                feedback.className = 'feedback incorrect show';
            }
            
            document.querySelectorAll('.answer').forEach(function(el, i) {
                el.style.pointerEvents = 'none';
                if (q.answers[i].correct) el.classList.add('correct');
                else if (i === idx) el.classList.add('incorrect');
            });
            
            answered.add(currentQ);
            updateScore();
            submitBtn.style.display = 'none';
            continueBtn.style.display = 'block';
        };
        
        continueBtn.onclick = function() {
            overlay.classList.remove('active');
            waiting = false;
            video.play();
        };
        
        function updateScore() {
            document.getElementById('score').textContent = correct + ' / ' + data.questions.length;
        }
        
        function showCompletion() {
            video.pause();
            const pct = Math.round((correct / data.questions.length) * 100);
            
            // Minimaal 50% nodig om te slagen
            const passed = pct >= 50;
            
            const scoreElement = document.getElementById('finalScore');
            scoreElement.textContent = pct + '%';
            
            // Kleur aanpassen op basis van score
            if (passed) {
                scoreElement.classList.remove('failed');
            } else {
                scoreElement.classList.add('failed');
            }
            
            let msg = '';
            if (passed) {
                // GESLAAGD - Mag verder
                if (pct === 100) {
                    msg = 'üéâ Perfect! Alle vragen goed! Je mag verder met de e-learning.';
                } else if (pct >= 80) {
                    msg = '‚úÖ Goed gedaan! Je hebt ' + pct + '% gescoord. Je mag verder met de e-learning.';
                } else {
                    msg = '‚úÖ Gehaald! Je hebt ' + pct + '% gescoord (minimaal 50% vereist). Je mag verder met de e-learning.';
                }
                
                // BELANGRIJK: Stuur voltooiingssignaal naar Rise 360
                window.parent.postMessage({ type: 'complete' }, '*');
                
                // Toon "Ga Verder" knop
                document.getElementById('continueToRise').style.display = 'inline-block';
            } else {
                // NIET GESLAAGD - Moet opnieuw
                msg = '‚ùå Helaas! Je hebt ' + pct + '% gescoord. Je hebt minimaal 50% nodig om verder te gaan. Bekijk de video opnieuw.';
                
                // Verberg "Ga Verder" knop
                document.getElementById('continueToRise').style.display = 'none';
            }
            
            document.getElementById('finalMessage').textContent = msg;
            infoBar.style.display = 'none';
            completion.classList.add('active');
        }
    </script>
</body>
</html>
