<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactieve Video Editor v2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #333; }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        video { width: 100%; max-width: 800px; display: block; margin: 20px 0; }
        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .question-item {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        .answer-item {
            margin: 5px 0;
            padding: 8px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .correct { background: #d4edda; }
        .success {
            background: #d4edda;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Interactieve Video Editor v2</h1>
    <p>Versie 1.0 - Maak interactieve video's met meerkeuze vragen</p>

    <div id="message"></div>

    <div class="section">
        <h2>1. Upload Video</h2>
        <input type="file" id="videoInput" accept="video/*" style="display: none;">
        <button id="uploadBtn">ðŸ“¹ Selecteer Video</button>
        <div id="videoInfo" style="display: none; margin-top: 10px;">
            <p><strong>Bestand:</strong> <span id="fileName"></span></p>
            <p><strong>Grootte:</strong> <span id="fileSize"></span></p>
            <p><strong>Duur:</strong> <span id="fileDuration"></span></p>
        </div>
        <video id="videoPlayer" controls style="display: none;"></video>
    </div>

    <div class="section" id="questionSection" style="display: none;">
        <h2>2. Voeg Vragen Toe</h2>
        <label>Tijdstempel (seconden):</label>
        <input type="number" id="questionTime" placeholder="Bijv. 30" min="0" step="1">
        <label>Vraag:</label>
        <textarea id="questionText" rows="3" placeholder="Typ hier je vraag..."></textarea>
        <label>Antwoorden (vink het juiste aan):</label>
        <div id="answersContainer">
            <div class="answer-item">
                <input type="radio" name="correct" value="0" checked> 
                <input type="text" class="answer-text" placeholder="Antwoord 1">
            </div>
            <div class="answer-item">
                <input type="radio" name="correct" value="1"> 
                <input type="text" class="answer-text" placeholder="Antwoord 2">
            </div>
            <div class="answer-item">
                <input type="radio" name="correct" value="2"> 
                <input type="text" class="answer-text" placeholder="Antwoord 3">
            </div>
            <div class="answer-item">
                <input type="radio" name="correct" value="3"> 
                <input type="text" class="answer-text" placeholder="Antwoord 4">
            </div>
        </div>
        <button id="addQuestionBtn">âž• Vraag Toevoegen</button>
    </div>

    <div class="section" id="questionsListSection" style="display: none;">
        <h2>3. Toegevoegde Vragen</h2>
        <div id="questionsList"></div>
    </div>

    <div class="section" id="exportSection" style="display: none;">
        <h2>4. Exporteren</h2>
        <p>Download je interactieve video als ZIP-bestand voor gebruik in Rise 360 of LMS.</p>
        <button id="exportBtn">ðŸ’¾ Download ZIP</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        console.log('Script gestart!');
        
        let videoFile = null;
        let questions = [];
        const PLAYER_HTML_URL = 'player.html';
        
        const videoInput = document.getElementById('videoInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoInfo = document.getElementById('videoInfo');
        const message = document.getElementById('message');
        const questionSection = document.getElementById('questionSection');
        const questionsListSection = document.getElementById('questionsListSection');
        const exportSection = document.getElementById('exportSection');
        const addQuestionBtn = document.getElementById('addQuestionBtn');
        const exportBtn = document.getElementById('exportBtn');
        const questionsList = document.getElementById('questionsList');
        
        uploadBtn.addEventListener('click', function() {
            console.log('Upload button clicked!');
            videoInput.click();
        });
        
        videoInput.addEventListener('change', function(e) {
            console.log('File selected!');
            const file = e.target.files[0];
            if (!file) return;
            
            console.log('File:', file.name);
            videoFile = file;
            
            const url = URL.createObjectURL(file);
            videoPlayer.src = url;
            videoPlayer.style.display = 'block';
            
            videoPlayer.onloadedmetadata = function() {
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = formatBytes(file.size);
                document.getElementById('fileDuration').textContent = formatTime(videoPlayer.duration);
                videoInfo.style.display = 'block';
                questionSection.style.display = 'block';
                showMessage('Video geladen! Je kunt nu vragen toevoegen.', 'success');
            };
        });
        
        addQuestionBtn.addEventListener('click', function() {
            const time = parseFloat(document.getElementById('questionTime').value);
            const text = document.getElementById('questionText').value.trim();
            const answerTexts = document.querySelectorAll('.answer-text');
            const correctRadio = document.querySelector('input[name="correct"]:checked');
            
            if (!time && time !== 0) {
                showMessage('Vul een tijdstempel in', 'error');
                return;
            }
            if (!text) {
                showMessage('Vul een vraag in', 'error');
                return;
            }
            
            const answers = [];
            answerTexts.forEach(function(input, i) {
                if (input.value.trim()) {
                    answers.push({
                        text: input.value.trim(),
                        correct: i === parseInt(correctRadio.value)
                    });
                }
            });
            
            if (answers.length < 2) {
                showMessage('Voeg minimaal 2 antwoorden toe', 'error');
                return;
            }
            
            questions.push({ time: time, question: text, answers: answers });
            questions.sort(function(a, b) { return a.time - b.time; });
            
            document.getElementById('questionTime').value = '';
            document.getElementById('questionText').value = '';
            answerTexts.forEach(function(input) { input.value = ''; });
            document.querySelector('input[name="correct"][value="0"]').checked = true;
            
            renderQuestions();
            showMessage('Vraag toegevoegd!', 'success');
        });
        
        function renderQuestions() {
            if (questions.length === 0) {
                questionsListSection.style.display = 'none';
                exportSection.style.display = 'none';
                return;
            }
            
            questionsListSection.style.display = 'block';
            exportSection.style.display = 'block';
            
            questionsList.innerHTML = questions.map(function(q, i) {
                const answersHTML = q.answers.map(function(a) {
                    return '<div class="' + (a.correct ? 'correct' : '') + '" style="padding: 5px; margin: 2px 0;">' +
                        (a.correct ? 'âœ“' : 'â—‹') + ' ' + a.text + '</div>';
                }).join('');
                
                return '<div class="question-item">' +
                    '<strong>' + formatTime(q.time) + '</strong> - ' + q.question +
                    '<div style="margin-top: 10px;">' + answersHTML + '</div>' +
                    '<button onclick="deleteQuestion(' + i + ')" style="background: #f44336; margin-top: 10px;">Verwijder</button>' +
                    '</div>';
            }).join('');
        }
        
        window.deleteQuestion = function(index) {
            questions.splice(index, 1);
            renderQuestions();
            showMessage('Vraag verwijderd', 'success');
        };
        
        exportBtn.addEventListener('click', async function() {
            if (!videoFile || questions.length === 0) return;
            
            exportBtn.disabled = true;
            exportBtn.textContent = 'Bezig met exporteren...';
            
            try {
                const zip = new JSZip();
                
                const ext = videoFile.name.split('.').pop();
                zip.file('video.' + ext, videoFile);
                
                const data = {
                    videoFileName: 'video.' + ext,
                    questions: questions
                };
                zip.file('data.json', JSON.stringify(data, null, 2));
                
                // Player HTML laden en toevoegen
                const playerResponse = await fetch(PLAYER_HTML_URL);
                const playerHTML = await playerResponse.text();
                zip.file('index.html', playerHTML);
                
                const content = await zip.generateAsync({type: 'blob'});
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'interactieve-video-' + Date.now() + '.zip';
                a.click();
                
                showMessage('Video succesvol geÃ«xporteerd!', 'success');
            } catch (error) {
                showMessage('Fout bij exporteren: ' + error.message, 'error');
            } finally {
                exportBtn.disabled = false;
                exportBtn.textContent = 'ðŸ’¾ Download ZIP';
            }
        });
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + secs.toString().padStart(2, '0');
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        function showMessage(text, type) {
            message.className = type;
            message.textContent = text;
            message.style.display = 'block';
            setTimeout(function() { message.style.display = 'none'; }, 4000);
        }
        
        console.log('Script loaded successfully!');
    </script>
</body>
</html>
